<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aqua-tan Smart Feeder</title>
<link rel="stylesheet" href="./pure.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css">
</head>
<body>
<div class="p-m pure-menu-horizontal pm-fix">
  <a href="#" class="pure-menu-heading"><img width='32' height='32' title='' alt='' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IB2cksfwAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAABnklEQVRYCb2XUVLEMAxDW4b7X7mgwssorp2mtDQzYMeWJcW7fLBs27bo56VzEPp4SVgyEl9/o+77+SSZiAf3xYxEdCKeOib2+6yBSCYBCJX7AVv1HbuMDEDUDdhF/SjCTKzbWJ9W34FZInCwSnhaXEOjDUBEFD4KqnbrZBuQiIu6QFYX/oqxjj8z4IJZLhOVkQw/NBcNAFYkz0hVmzURcbo3bjegopo+gJE28N3341jqzHCPseNyAw7ESCbgOOVgY70TsmbHGf8KsiEGsh4GPDqOHA7z8ZNWG3CgSCDyOjl9MJkYPWZanDHQwBMJQpUJzLa+fwQUIYl6Z33wmhcWvNfJW3x6AxDzUu6KGCLuPd+Ag5/K4zY7cYn81wamH3BlA/E10yIj4JsbOKxfxqoNZOA7G8j49sVkGxA4EytJdqb613ButIHMRC2Td4biGsk2ANXpMMA/Rj1wqzYAp0z4JtyU18HHeIZZRxuIZE/f98ecbSCKnr0o4qt72+RVAxXhTL2JOvjMwJ0Xp4Iurvzud6ASqepRf1lf/Nf8IK7CF5KQSk/UTlbbAAAAAElFTkSuQmCC'></a>
  <ul class="pure-menu-list">
    <li class="pure-menu-item"><a href="#" class="pure-menu-link">Aqua-tan Smart Feeder</a></li>
  </ul>  
</div>

<div class="l-content">

  <div class="a-t pure-g">

    <div id="feed" class="pure-u-1 pure-u-md-1-3">
      <div class="at at-feed">
        <div class="at-header">
          <h2>Feed</h2>
          <span class="at-val">
            <div id="fs">--</div><span id="fv">--</span>
          </span>
        </div>
      </div>
      <button id="dofeed" type="submit" class="pure-button pure-button-primary">Do feed</button>
    </div>

  </div>
  
  <div id="settings">

    <div id="sec_sch" class="if pure-g">
      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Auto feeding schedule</h3>
          <p>Set the schedule of feeding.</p>
          <p>
	    <form name="config" id="frm_sch" class="pure-form pure-form-stacked">
	      <fieldset>
		<legend>Scheduler</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-1">
		    <input id="enable" value="1" type="checkbox"> Enable
		  </div>
		</div>
		<legend>Feed time 1</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    Time:
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft1_h" class="pure-u-22-24" type="text" placeholder="hour">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft1_m" class="pure-u-22-24" type="text" placeholder="min">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    Rotation:
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft1_r" class="pure-u-22-24" type="text" placeholder="rotation">
		  </div>
		</div>
		<legend>Feed time 2</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    Time:
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft2_h" class="pure-u-22-24" type="text" placeholder="hour">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft2_m" class="pure-u-22-24" type="text" placeholder="min">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    Rotation:
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft2_r" class="pure-u-22-24" type="text" placeholder="rotation">
		  </div>
		</div>
		<legend>Feed time 3</legend>
		<div class="pure-g">
		  <div class="pure-u-1 pure-u-md-1-5">
		    Time:
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft3_h" class="pure-u-22-24" type="text" placeholder="hour">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft3_m" class="pure-u-22-24" type="text" placeholder="min">
		  </div>
		  <div class="pure-u-1 pure-u-md-1-5">
		  Rotation:</div>
		  <div class="pure-u-1 pure-u-md-1-5">
		    <input id="ft3_r" class="pure-u-22-24" type="text" placeholder="rotation">
		  </div>
		</div>

		<button id="sch_sub" type="submit" class="pure-button pure-button-primary">Submit</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
        </div>
      </div>


      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Reset WiFi settings</h3>
          <p>Reset the WiFi AP setting by clicking this button.</p>
	  <p>
	    <form action="/wifireset" class="pure-form pure-form-stacked">
	      <fieldset>
		<button type="submit" class="btn-red pure-button">Reset</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>

      <div class="pure-u-1 pure-u-md-1-2">
        <div class="l-box">
          <h3 class="if-head">Reset ALL settings</h3>
          <p>Reset the ALL setting by clicking this button.</p>
	  <p>
	    <form action="/reset" class="pure-form pure-form-stacked">
	      <fieldset>
		<button type="submit" class="btn-red pure-button">Reset</button>
	      </fieldset>
	    </form>
          </p>
        </div>
      </div>	
    </div> <!-- end if -->
  </div> <!-- end setting -->
</div> <!-- end l-content -->
<div class="footer l-box">
    <p>
        Aqua-tan Smart Feeder by @omzn 2017 / All rights researved
    </p>
</div>
<script type="text/javascript">

$('form#frm_sch').submit(
    function(ev) {
	$.post('/config',
                "enable="+$('#enable').prop('checked').toString()
               +"&ft1_h="+$('#ft1_h').val()
               +"&ft1_m="+$('#ft1_m').val()
               +"&ft1_r="+$('#ft1_r').val()
               +"&ft2_h="+$('#ft2_h').val()
               +"&ft2_m="+$('#ft2_m').val()
               +"&ft2_r="+$('#ft2_r').val()
               +"&ft3_h="+$('#ft3_h').val()
               +"&ft3_m="+$('#ft3_m').val()
               +"&ft3_r="+$('#ft3_r').val()
               ,
	       read,"json");
	$('#sch_sub').prop('disabled', true);
	return false;
    });

function read(json) {
    if (json.enable == "true") {
	$('#enable').prop("checked",true);
    } else {
	$('#enable').prop("checked",false);
    }
    $('#ft1_h').val(json.ft1_h);
    $('#ft1_m').val(json.ft1_m);
    $('#ft1_r').val(json.ft1_r);
    $('#ft2_h').val(json.ft2_h);
    $('#ft2_m').val(json.ft2_m);
    $('#ft2_r').val(json.ft2_r);
    $('#ft3_h').val(json.ft3_h);
    $('#ft3_m').val(json.ft3_m);
    $('#ft3_r').val(json.ft3_r);
}

function update() {
    $.getJSON('/status',function(json){
        $('#fs').html(json.fed.toString());
        $('#fv').html(json.rotated.toString());
    });
}

function confset() {
    $.getJSON('/config',function(json){
	read(json);
        if($('#enable').is(":checked")){
            propchange(false);
	} else {
	    $('#sch_sub').prop('disabled', true);
            propchange(true);
	}
    $('#ft1_h').val(json.ft1_h);
    $('#ft1_m').val(json.ft1_m);
    $('#ft1_r').val(json.ft1_r);
    $('#ft2_h').val(json.ft2_h);
    $('#ft2_m').val(json.ft2_m);
    $('#ft2_r').val(json.ft2_r);
    $('#ft3_h').val(json.ft3_h);
    $('#ft3_m').val(json.ft3_m);
    $('#ft3_r').val(json.ft3_r);

    });
}

function propchange(val) {
	    $('#ft1_h').prop('disabled', val);
	    $('#ft1_m').prop('disabled', val);
	    $('#ft1_r').prop('disabled', val);
	    $('#ft2_h').prop('disabled', val);
	    $('#ft2_m').prop('disabled', val);
	    $('#ft2_r').prop('disabled', val);
	    $('#ft3_h').prop('disabled', val);
	    $('#ft3_m').prop('disabled', val);
	    $('#ft3_r').prop('disabled', val);
}


$(function() {
    
    $('#enable').click(function(){
	if($(this).is(":checked")){
            propchange(false);
	    $.post('/config',
		   "enable="+$('#enable').prop('checked').toString(),
		   read,"json");
	} else if($(this).is(":not(:checked)")){
	    $('#sch_sub').prop('disabled', true);
            propchange(true);
	    $.post('/config',
		   "enable="+$('#enable').prop('checked').toString(),
		   read,"json");
	}
    });

    $('#dofeed').click(function(){
        $.post('/feed',update);
    });

    $('#sch_sub').prop('disabled', true);

    $('#ft1_h').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });
    
    $('#ft1_m').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft1_r').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft2_h').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft2_m').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft2_r').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft3_h').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft3_m').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    $('#ft3_r').keyup(function() {
	if($(this).val() != '') {
	    $('#sch_sub').prop('disabled', false);
	}
    });

    confset();
    update();
    setInterval("update()",15000);
});

</script>
</body>
</html>
